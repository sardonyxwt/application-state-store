!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("store",[],t):"object"==typeof exports?exports.store=t():e.store=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var o,i,a,s=r(1),c=r(2);!function(e){e.GETTER="GETTER",e.SETTER="SETTER",e.FUNCTION="FUNCTION"}(o=t.ScopeMacroType||(t.ScopeMacroType={})),function(e){e.REGISTER_MACRO="REGISTER_MACRO",e.REGISTER_ACTION="REGISTER_ACTION",e.LOCK="LOCK"}(i=t.ScopeChangeEventType||(t.ScopeChangeEventType={})),function(e){e.CREATE_SCOPE="CREATE_SCOPE",e.LOCK="LOCK"}(a=t.StoreChangeEventType||(t.StoreChangeEventType={}));var u=new Map,f={onCreateStore:function(){return null},onChangeStore:function(){return null},onCreateScope:function(){return null},onChangeScope:function(){return null},onAction:function(){return null},onActionError:function(){return null},onActionListenerError:function(){return null}};t.RESET_SCOPE_ACTION="_reset",t.RESTORE_SCOPE_ACTION="_restore";var l=function(){function e(e,r){var o=this;this._context=null,this._contextEvent=null,this._isActionInProgress=!1,this._actions=new Map,this._listeners=new Map,this._listenerIdGenerator=c.createUniqueIdGenerator("ScopeListener");var i=r.name,a=r.initState,s=r.middleware,u=r.isImmutabilityEnabled,f=r.isSubscribedMacroAutoCreateEnabled,l=r.isFrozen;this.store=e,this.name=i,this.isImmutabilityEnabled=u,this.isSubscribedMacroAutoCreateEnabled=f,this._state=a,this._initState=a,this._middleware=n(s).reverse(),this.registerAction(t.RESET_SCOPE_ACTION,(function(){return o._initState})),this.registerAction(t.RESTORE_SCOPE_ACTION,(function(e,t){return o._initState=t,t})),this._isFrozen=l}return Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isFrozen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isActionDispatchAvailable",{get:function(){return!this._isActionInProgress},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportActions",{get:function(){return Array.from(this._actions.keys())},enumerable:!0,configurable:!0}),e.prototype.registerAction=function(e,t,r){var n=this;if(this._isFrozen)throw new Error("This scope is locked you can't add new action.");if(this._actions.has(e)||this.isSubscribedMacroAutoCreateEnabled&&e in this)throw new Error("Action name "+e+" is duplicate or reserved in scope "+this.name+".");this._actions.set(e,t);var o=function(t,o){var i=n.dispatch(e,t,o);return r?r(i,t):i};if(this.isSubscribedMacroAutoCreateEnabled){var a="on"+(e.charAt(0).toUpperCase()+e.slice(1));this.registerMacro(a,(function(t,r){return n.subscribe(r,[e])}))}return this[e]=o,f.onChangeScope(this,{type:i.REGISTER_ACTION,actionName:e}),o},e.prototype.registerMacro=function(e,t,r){var n=this;if(void 0===r&&(r=o.FUNCTION),!t)throw new Error("Macro cannot be null or undefined.");if(this._isFrozen)throw new Error("This scope is locked you can't add new macro.");if(e in this&&("function"==typeof n[e]||r===o.FUNCTION||r===o.GETTER&&Object.getOwnPropertyDescriptor(this,e).get||r===o.SETTER&&Object.getOwnPropertyDescriptor(this,e).set))throw new Error("Macro name "+e+" is reserved in scope "+this.name+".");var a=function(e){return t(n._state,e)};switch(r){case o.FUNCTION:this[e]=a;break;case o.GETTER:Object.defineProperty(this,e,{get:a,configurable:!0,enumerable:!0});break;case o.SETTER:Object.defineProperty(this,e,{set:a,configurable:!0,enumerable:!0})}f.onChangeScope(this,{type:i.REGISTER_MACRO,macroName:e,macroType:r})},e.prototype.dispatch=function(e,t,r){var n=this;void 0===r&&(r=!0);var o=this._actions.get(e);if(!o)throw new Error("This action not exists "+e);if(this._isActionInProgress)throw new Error("Now action dispatch not available. Other action spreads.");this.isImmutabilityEnabled&&t&&"object"==typeof t&&s.deepFreeze(t),this._middleware.forEach((function(e){return o=e.appendActionMiddleware(o)}));var i=!this._isActionInProgress;i&&(this._isActionInProgress=!0);var a,c=i?this._state:this._context,u=function(r){return{reason:r,oldState:c,scopeName:n.name,actionName:e,props:t}},l=function(r){var o;return{props:t,oldState:c,newState:r,actionName:e,parentEvent:null!==(o=n._contextEvent)&&void 0!==o?o:null,scopeName:n.name,storeName:n.store.name,childrenEvents:[]}};try{return function(e){n.isImmutabilityEnabled&&e&&"object"==typeof t&&s.deepFreeze(e),n._context=e,r&&(i?n._contextEvent=l(e):null==n||n._contextEvent.childrenEvents.push(l(e)));var o=function(e){f.onAction(e),n._listeners.forEach((function(t){try{null==t||t(e)}catch(e){f.onActionListenerError(u(e))}}))};return i&&(n._state=e,n._contextEvent&&(n._contextEvent.childrenEvents.forEach(o),o(n._contextEvent)),n._context=null,n._contextEvent=null,n._isActionInProgress=!1),e}(o(c,t))}catch(e){throw a=u(e),i&&f.onActionError(a),a}},e.prototype.subscribe=function(e,t){var r=this;void 0===t&&(t=[]),t.forEach((function(e){if(!r._actions.has(e))throw new Error("Action ("+e+") not present in scope.")}));var n=this._listenerIdGenerator();return this._listeners.set(n,0===t.length?e:function(r){-1!==t.findIndex((function(e){return e===r.actionName}))&&e(r)}),Object.assign((function(){return r.unsubscribe(n)}),{listenerId:n})},e.prototype.unsubscribe=function(e){return this._listeners.delete(e)},e.prototype.lock=function(){this._isFrozen=!0,f.onChangeScope(this,{type:i.LOCK})},e.prototype.reset=function(e){return this.dispatch(t.RESET_SCOPE_ACTION,null,e)},e.prototype.restore=function(e,r){return this.dispatch(t.RESTORE_SCOPE_ACTION,e,r)},e}(),p=function(){function e(e){this._scopes=new Map,this._statesToRestore=new Map,this._scopeNameGenerator=c.createUniqueIdGenerator("Scope"),this.name=e.name,this._isFrozen=e.isFrozen}return Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isFrozen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){var e={};return this._scopes.forEach((function(t){e[t.name]=t.state})),e},enumerable:!0,configurable:!0}),e.prototype.createScope=function(e,t){if(void 0===e&&(e={}),this._isFrozen)throw new Error("This Store is locked you can't add new scope.");var r=e.name,n=void 0===r?this._scopeNameGenerator():r,o=e.initState,i=void 0===o?null:o,s=e.middleware,c=void 0===s?[]:s,u=e.isImmutabilityEnabled,p=void 0!==u&&u,h=e.isSubscribedMacroAutoCreateEnabled,d=void 0!==h&&h,y=e.isFrozen,b=void 0!==y&&y;if(this._scopes.has(n))throw new Error("Scope name must unique");var v=t&&this._statesToRestore.has(n),E=v?this._statesToRestore.get(n):i;v&&this._statesToRestore.delete(n);var _=new l(this,{name:n,initState:E,middleware:c,isImmutabilityEnabled:p,isSubscribedMacroAutoCreateEnabled:d,isFrozen:b});return this._scopes.set(n,_),c.forEach((function(e){return e.postSetup(_)})),f.onCreateScope(_),f.onChangeStore(this,{type:a.CREATE_SCOPE,scopeName:n}),_},e.prototype.getScope=function(e){return this._scopes.get(e)},e.prototype.hasScope=function(e){return this._scopes.has(e)},e.prototype.lock=function(){this._isFrozen=!0,this._scopes.forEach((function(e){return e.lock()})),f.onChangeStore(this,{type:a.LOCK})},e.prototype.reset=function(e){this._scopes.forEach((function(t){return t.reset(e)}))},e.prototype.restore=function(e){var t=this;e.forEach((function(e,r){t.hasScope(r)?t.getScope(r).restore(e):t._statesToRestore.set(r,e)}))},e}();function h(e){return u.has(e)}t.isStoreExist=h,t.createStore=function(e){var t=e.name,r=e.isFrozen,n=void 0!==r&&r;if(h(t))throw new Error("Store name must unique");var o=new p({name:t,isFrozen:n});return u.set(t,o),f.onCreateStore(o),o},t.getStore=function(e){return u.get(e)},t.getState=function(){var e={};return u.forEach((function(t){e[t.name]=t.state})),e},t.setStoreDevTool=function(e){Object.assign(f,e)}},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([,function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.deepFreeze=function e(t){return Object.getOwnPropertyNames(t).forEach((function(r){var n=t[r];"object"==typeof n&&null!==n&&e(n)})),Object.freeze(t)},t.flatten=function(e){var t={};return function e(r,n){if(Object(r)!==r)t[n]=r;else if(Array.isArray(r))if(0===r.length)t[n]=[];else for(var o=0;o<r.length;o++)e(r[o],n?n+"."+o:""+o);else{var i=Object.getOwnPropertyNames(r);0!==i.length?i.forEach((function(t){return e(r[t],n?n+"."+t:t)})):t[n]={}}}(e,""),t},t.unflatten=function(e){if(Object(e)!==e||Array.isArray(e))return e;var t,r,n,o,i={};return Object.getOwnPropertyNames(e).forEach((function(a){t=i,r="",n=a.split(".");for(var s=0;s<n.length;s++)o=!isNaN(parseInt(n[s],10)),t=t[r]||(t[r]=o?[]:{}),r=n[s];t[r]=e[a]})),i[""]},t.stringifyValue=function(e){return null==e?"":"number"==typeof e?""+e:"object"==typeof e?JSON.stringify(e):e},t.resolveValue=function(e,t){for(var r=t.split(/[.\[\]]/).filter((function(e){return""!==e})),n=e,o=0;o<r.length;o++){if(!n||"object"!=typeof n){n=void 0;break}n=n[r[o]]}return n},t.clone=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)},t.cloneArray=function(e){return e.map(t.clone)},t.cloneArrays=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=[];return e.forEach((function(e){return e.forEach((function(e){return n.push(t.clone(e))}))})),n},t.copyArray=function(e){return n(e)},t.copyArrays=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=[];return e.forEach((function(e){return r.push.apply(r,e)})),r},t.resolveArray=function(e){return Array.isArray(e)?e:[e]},t.arrayFrom=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.copyArrays.apply(void 0,e.map(t.resolveArray))},t.saveToArray=function(e,t,r){void 0===r&&(r=function(e,t){return e===t});var n=e.findIndex((function(e,n,o){return r(e,t,n,o)}));-1!==n?e[n]=t:e.push(t)},t.deleteFromArray=function(e,t){var r=e.findIndex(t);-1!==r&&e.splice(r,1)}}])},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateSalt=function(e,t){void 0===e&&(e=16),void 0===t&&(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var r="";r.length<e;)r+=t.charAt(Math.floor(Math.random()*t.length));return r},t.generateUUID=function(){return t.generateSalt(4)+"-"+t.generateSalt(4)+"-"+t.generateSalt(4)+"-"+t.generateSalt(4)},t.createUniqueIdGenerator=function(e){var r=0,n=e+":"+t.generateUUID();return function(){return n+":"+ ++r}}}])}])}));
//# sourceMappingURL=state-store.min.js.map