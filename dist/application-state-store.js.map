{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///dist/application-state-store.js","webpack:///webpack/bootstrap 31f3acb795e73fbefaf5","webpack:///./src/index.ts","webpack:///./src/utils.ts"],"names":["root","factory","exports","module","define","amd","a","i","self","this","modules","__webpack_require__","moduleId","installedModules","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","default","object","property","prototype","hasOwnProperty","p","s","registerScope","initScope","scopeId","utils_1","uniqueId","scopes","Error","deepFreeze","registerAction","action","ROOT_SCOPE","actionId","actions","func","dispatch","props","oldScope","Promise","resolve","reject","then","newScope","values","listeners","filter","it","forEach","subscribe","listener","newListener","listenerId","unsubscribe","getScope","getState","__assign","assign","t","arguments","length","value","indexes","obj","keys","key","prop","freeze","getOwnPropertyNames","push"],"mappings":"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","file":"./dist/application-state-store.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar utils_1 = __webpack_require__(1);\r\nvar scopes = {};\r\nvar actions = {};\r\nvar listeners = {};\r\nexports.ROOT_SCOPE = registerScope('rootScope');\r\nfunction registerScope(name, initScope) {\r\n    if (name === void 0) { name = 'scope'; }\r\n    if (initScope === void 0) { initScope = {}; }\r\n    var scopeId = utils_1.uniqueId(name);\r\n    if (scopeId in scopes) {\r\n        throw new Error(\"This scope already exists \" + scopeId);\r\n    }\r\n    scopes[scopeId] = utils_1.deepFreeze(initScope);\r\n    return scopeId;\r\n}\r\nfunction registerAction(action, scopeId) {\r\n    if (scopeId === void 0) { scopeId = exports.ROOT_SCOPE; }\r\n    var isScopeExists = scopeId in scopes;\r\n    if (!isScopeExists) {\r\n        throw new Error(\"This scope not exists \" + scopeId);\r\n    }\r\n    var actionId = utils_1.uniqueId('store_action');\r\n    actions[actionId] = { scopeId: scopeId, func: action };\r\n    return actionId;\r\n}\r\nfunction dispatch(actionId, props) {\r\n    var action = actions[actionId];\r\n    if (!action) {\r\n        throw new Error(\"This action not exists \" + actionId);\r\n    }\r\n    var scopeId = action.scopeId;\r\n    var oldScope = scopes[scopeId];\r\n    return new Promise(function (resolve, reject) {\r\n        action.func(oldScope, props, resolve);\r\n    }).then(function (newScope) {\r\n        utils_1.deepFreeze(newScope);\r\n        utils_1.values(listeners)\r\n            .filter(function (it) { return it.scopeId === scopeId; })\r\n            .forEach(function (it) { return it.func({ oldScope: oldScope, newScope: newScope, actionId: actionId }); });\r\n        scopes[scopeId] = newScope;\r\n        return newScope;\r\n    });\r\n}\r\nfunction subscribe(listener, scopeId) {\r\n    if (scopeId === void 0) { scopeId = exports.ROOT_SCOPE; }\r\n    var scope = scopes[scopeId];\r\n    if (!scope) {\r\n        throw new Error(\"This action not exists \" + scopeId);\r\n    }\r\n    var newListener = { scopeId: scopeId, func: listener };\r\n    var listenerId = utils_1.uniqueId('listener');\r\n    listeners[listenerId] = newListener;\r\n    return listenerId;\r\n}\r\nfunction unsubscribe(listenerId) {\r\n    delete listeners[listenerId];\r\n}\r\nfunction getScope(scopeId) {\r\n    if (scopeId === void 0) { scopeId = exports.ROOT_SCOPE; }\r\n    return scopes[scopeId];\r\n}\r\nfunction getState() {\r\n    return __assign({}, scopes);\r\n}\r\nexports.default = {\r\n    registerScope: registerScope,\r\n    registerAction: registerAction,\r\n    dispatch: dispatch,\r\n    subscribe: subscribe,\r\n    unsubscribe: unsubscribe,\r\n    getScope: getScope,\r\n    getState: getState\r\n};\r\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar indexes = {};\r\nfunction uniqueId(name) {\r\n    if (name === void 0) { name = 'default'; }\r\n    indexes[name] ? ++indexes[name] : indexes[name] = 0;\r\n    var index = indexes[name];\r\n    return \"\" + name + (index ? index : '');\r\n}\r\nexports.uniqueId = uniqueId;\r\nfunction deepFreeze(obj) {\r\n    keys(obj).forEach(function (key) {\r\n        var prop = obj[key];\r\n        if (typeof prop == 'object' && prop !== null) {\r\n            deepFreeze(prop);\r\n        }\r\n    });\r\n    return Object.freeze(obj);\r\n}\r\nexports.deepFreeze = deepFreeze;\r\nfunction keys(object) {\r\n    return Object.getOwnPropertyNames(object);\r\n}\r\nexports.keys = keys;\r\nfunction values(object) {\r\n    var values = [];\r\n    for (var key in object) {\r\n        values.push(object[key]);\r\n    }\r\n    return values;\r\n}\r\nexports.values = values;\r\n\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// dist/application-state-store.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 31f3acb795e73fbefaf5","import { uniqueId, deepFreeze, keys, values } from './utils';\r\n\r\ntype ListenerEventType = { newScope: any, oldScope: any, actionId: string };\r\ntype ListenerType = (event: ListenerEventType) => void;\r\ntype ActionType = (\r\n  scope: any,\r\n  props: any,\r\n  resolved: (newScope: any) => void\r\n) => void;\r\ntype Action = { scopeId: string, func: ActionType };\r\ntype Listener = { scopeId: string, func: ListenerType };\r\n\r\nconst scopes: { [id: string]: any } = {};\r\nconst actions: { [id: string]: Action } = {};\r\nconst listeners: { [id: string]: Listener } = {};\r\n\r\nexport const ROOT_SCOPE = registerScope('rootScope');\r\n\r\nfunction registerScope(name: string = 'scope', initScope: any = {}) {\r\n  const scopeId = uniqueId(name);\r\n\r\n  if (scopeId in scopes) {\r\n    throw new Error(`This scope already exists ${scopeId}`);\r\n  }\r\n\r\n  scopes[scopeId] = deepFreeze(initScope);\r\n  return scopeId;\r\n}\r\n\r\nfunction registerAction(action: ActionType, scopeId = ROOT_SCOPE) {\r\n  const isScopeExists = scopeId in scopes;\r\n\r\n  if (!isScopeExists) {\r\n    throw new Error(`This scope not exists ${scopeId}`);\r\n  }\r\n\r\n  const actionId = uniqueId('store_action');\r\n  actions[actionId] = { scopeId, func: action };\r\n  return actionId;\r\n}\r\n\r\nfunction dispatch(actionId: string, props: any) {\r\n  const action = actions[actionId];\r\n\r\n  if (!action) {\r\n    throw new Error(`This action not exists ${actionId}`);\r\n  }\r\n\r\n  const scopeId = action.scopeId;\r\n  const oldScope = scopes[scopeId];\r\n\r\n  return new Promise((resolve, reject) => {\r\n    action.func(oldScope, props, resolve);\r\n  }).then(newScope => {\r\n    deepFreeze(newScope)\r\n    values(listeners)\r\n      .filter(it => it.scopeId === scopeId)\r\n      .forEach(it => it.func({ oldScope, newScope, actionId }));\r\n    scopes[scopeId] = newScope;\r\n    return newScope;\r\n  });\r\n}\r\n\r\nfunction subscribe(listener: ListenerType, scopeId = ROOT_SCOPE) {\r\n  const scope = scopes[scopeId];\r\n\r\n  if (!scope) {\r\n    throw new Error(`This action not exists ${scopeId}`);\r\n  }\r\n\r\n  const newListener = { scopeId, func: listener };\r\n  const listenerId = uniqueId('listener');\r\n\r\n  listeners[listenerId] = newListener;\r\n  return listenerId;\r\n}\r\n\r\nfunction unsubscribe(listenerId: string) {\r\n  delete listeners[listenerId];\r\n}\r\n\r\nfunction getScope(scopeId = ROOT_SCOPE) {\r\n  return scopes[scopeId];\r\n}\r\n\r\nfunction getState() {\r\n  return { ...scopes };\r\n}\r\n\r\nexport default {\r\n  registerScope,\r\n  registerAction,\r\n  dispatch,\r\n  subscribe,\r\n  unsubscribe,\r\n  getScope,\r\n  getState\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","let indexes: { [key: string]: number } = {};\r\n\r\nexport function uniqueId(name: string = 'default') {\r\n  indexes[name] ? ++indexes[name] : indexes[name] = 0;\r\n  let index = indexes[name];\r\n  return `${name}${index ? index : ''}`;\r\n}\r\n\r\nexport function deepFreeze<T>(obj: T) {\r\n  keys(obj).forEach(function(key) {\r\n    var prop = obj[key];\r\n    if (typeof prop == 'object' && prop !== null) {\r\n      deepFreeze(prop);\r\n    }\r\n  });\r\n  return Object.freeze(obj);\r\n}\r\n\r\nexport function keys(object: Object) {\r\n  return Object.getOwnPropertyNames(object);\r\n}\r\n\r\nexport function values<T>(object: {[key: string]: T}) {\r\n  const values: T[] = [];\r\n  for (let key in object) {\r\n    values.push(object[key]);\r\n  }\r\n  return values;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.ts"],"sourceRoot":""}